---
import SiteLayout from '../../layouts/SiteLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const updates = await getCollection('updates');
  return updates.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const title = `${entry.data.title} — Cynchorus Updates`;
const description = entry.data.summary ?? 'Dispatch from the Cynchorus lab.';
---
<SiteLayout title={title} description={description} ogImage="/favicon.svg">
  <article class="space-y-6">
    <header class="space-y-3">
      <p class="text-xs uppercase tracking-[0.35em] text-indigo-200/70">
        {entry.data.published
          ? new Date(entry.data.published).toLocaleDateString(undefined, {
              year: 'numeric',
              month: 'short',
              day: 'numeric',
            })
          : 'Undated dispatch'}
      </p>
      <h1 class="text-3xl font-medium tracking-[0.2em] text-white sm:text-4xl">{entry.data.title}</h1>
      {entry.data.summary && <p class="max-w-2xl text-indigo-100/90">{entry.data.summary}</p>}
      <p class="text-xs uppercase tracking-[0.3em] text-indigo-200/70">// TODO: content block — add update metadata</p>
    </header>
    <div class="space-y-4 text-indigo-100/90 leading-relaxed">
      <Content />
    </div>
    <footer class="border-t border-indigo-300/20 pt-6 text-xs uppercase tracking-[0.3em] text-indigo-200/70">
      // TODO: content block — add follow-up actions & archive links
    </footer>
  </article>
</SiteLayout>
