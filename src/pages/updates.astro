---
import SiteLayout from '../layouts/SiteLayout.astro';
import { getCollection } from 'astro:content';

const updates = await getCollection('updates');
const sortedUpdates = updates.sort((a, b) => {
  const aDate = a.data.published ? new Date(a.data.published).getTime() : 0;
  const bDate = b.data.published ? new Date(b.data.published).getTime() : 0;
  return bDate - aDate;
});
---
<SiteLayout title="Cynchorus — Updates" description="Project news, release notes, and lab activity from the Cynchorus collective." ogImage="/favicon.svg">
  <section class="space-y-10">
    <header class="space-y-3">
      <h1 class="text-3xl font-light uppercase tracking-[0.35em] text-white sm:text-4xl">News & project log</h1>
      <p class="max-w-3xl text-lg text-slate-300">
        Follow the cadence of releases, field recordings, and community gatherings as the Harmonic Machine Threshold
        evolves.
      </p>
      <p class="text-xs uppercase tracking-[0.3em] text-indigo-200/70">// TODO: content block — add RSS link & update cadence</p>
    </header>
    <div class="space-y-6">
      {sortedUpdates.length === 0 ? (
        <p class="text-sm uppercase tracking-[0.3em] text-slate-400">No updates logged yet.</p>
      ) : (
        <ul class="space-y-4">
          {sortedUpdates.map((entry) => (
            <li class="rounded-2xl border border-indigo-400/20 bg-indigo-400/10 p-6 backdrop-blur transition hover:border-indigo-400/40">
              <a class="block space-y-2" href={`/updates/${entry.slug}/`}>
                <p class="text-xs uppercase tracking-[0.35em] text-indigo-200/80">
                  {entry.data.published
                    ? new Date(entry.data.published).toLocaleDateString(undefined, {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                      })
                    : 'Undated dispatch'}
                </p>
                <h2 class="text-xl font-medium tracking-[0.15em] text-white">{entry.data.title}</h2>
                {entry.data.summary && <p class="text-sm text-indigo-100/90">{entry.data.summary}</p>}
              </a>
            </li>
          ))}
        </ul>
      )}
    </div>
  </section>
</SiteLayout>
